(function(a){a.suggest=function(b,c){var d=this;d.input=b;d.options=c;d.$input=a(b).attr("autocomplete","off");d.$results=a(document.createElement("ul"));d.currentItem=-1;d.items=false;d.timeout=false;d.prevLength=0;d.cache=[];d.cacheSize=0;d.$results.addClass(d.options.resultsClass).appendTo("body");d.resetPosition();a(window).load(function(){d.resetPosition();}).resize(function(){d.resetPosition();});d.$input.blur(function(){setTimeout(function(){d.hideResults();},200);});try{d.$results.bgiframe();}catch(f){}if(a.browser.mozilla){d.$input.keypress(function(g){d.processKey(g);});}else{d.$input.keydown(function(g){d.processKey(g);});}};a.extend(a.suggest.prototype,{addMatchClass:function(b,c){return b.replace(new RegExp(c,"ig"),'<span class="'+this.options.matchClass+'">$&</span>');},resetPosition:function(){var b=this.$input.offset();this.$results.css({top:(b.top+this.input.offsetHeight)+"px",left:b.left+"px"});},processKey:function(c){if((/27$|38$|40$/.test(c.keyCode)&&this.$results.is(":visible"))||(/^13$|^9$/.test(c.keyCode)&&this.currentItem>=0)){if(c.preventDefault){c.preventDefault();}if(c.stopPropagation){c.stopPropagation();}c.cancelBubble=true;c.returnValue=false;switch(c.keyCode){case 38:this.selectItem(this.currentItem-1);break;case 40:this.selectItem(this.currentItem+1);break;case 9:case 13:this.selectCurrentItem();break;case 27:this.hideResults();break;}}else{if(this.$input.val().length!=this.prevLength){var b=this;if(b.timeout){clearTimeout(b.timeout);}b.timeout=setTimeout(function(){b.suggest();},b.options.delay);b.prevLength=b.$input.val().length;}}},suggest:function(){var c=a.trim(this.$input.val());if(c.length>=this.options.minchars){cached=this.checkCache(c);if(cached){this.items=cached.items;this.displayItems(c);}else{var b=this;a.get(b.options.source,{q:c},function(d){b.hideResults();b.items=b.options.createItems?b.options.createItems.call(this,d):d.split(b.options.delimiter);b.displayItems(c);b.addToCache(c,d.length);});}}else{this.hideResults();}},checkCache:function(c){for(var b=0;b<this.cache.length;b++){if(this.cache[b]["q"]==c){this.cache.unshift(this.cache.splice(b,1)[0]);return this.cache[0];}}return false;},addToCache:function(d,b){while(this.cache.length&&(this.cacheSize+b>this.options.maxCacheSize)){var c=this.cache.pop();this.cacheSize-=c.size;}this.cache.push({q:d,size:b,items:this.items});this.cacheSize+=b;},displayItems:function(f){var d=this;if(!d.items){return;}var c="";for(var b=0;b<d.items.length;b++){var e=d.options.formatItem?d.options.formatItem.call(d,d.items[b],f):d.formatItem(d.items[b],f);if(!e){d.items.splice(b,1);}else{c+=e;}}if(!d.items.length){d.hideResults();return;}d.$results.html(c).show().children().mouseover(function(){var h=d.$results.children();for(var g=0;g<h.length;g++){if(h[g]==this){break;}}d.selectItem(g);}).click(function(g){d.selectCurrentItem();return false;});},formatItem:function(b,c){b=a.trim(b);if(b){return"<li>"+this.addMatchClass(b,c)+"</li>";}return false;},hideResults:function(){this.$results.hide();this.currentItem=-1;},selectItem:function(b){if(b<0){b=this.items.length-1;}if(b>=this.items.length){b=0;}this.currentItem=b;this.$results.children().removeClass(this.options.selectClass).eq(b).addClass(this.options.selectClass);},selectCurrentItem:function(){if(this.currentItem>=0){var b=this.currentItem;this.$input.val(this.options.selectItemText?this.options.selectItemText.call(this,this.items[b]):this.$results.children().eq(b).text());this.hideResults();if(this.options.onSelect){this.options.onSelect.call(this.$input[0],this.items[b]);}}}});a.fn.suggest=function(c,b){if(!c){return;}b=a.extend({delay:100,resultsClass:"ac_results",selectClass:"ac_over",matchClass:"ac_match",minchars:2,delimiter:"\n",createItems:false,formatItem:false,selectItemText:false,onSelect:false,maxCacheSize:65536},b);b.source=c;this.each(function(){new a.suggest(this,b);});return this;};})(jQuery);